@model IEnumerable<Property>

<div class="container">
    <div class="text-center my-4">
        <h1 class="display-4">Güncel İlanlar</h1>
        <p>Hayalinizdeki evi bulmak artık çok kolay.</p>

        <div class="mt-3">
            <button class="btn btn-dark filter-btn" data-id="0">Tümü</button>
            @foreach (var cat in ViewBag.Categories)
            {
                <button class="btn btn-outline-dark filter-btn" data-id="@cat.Id">@cat.Name</button>
            }
        </div>
    </div>

    <div class="row" id="propertyListContainer">
        <partial name="_PropertyListPartial" model="Model" />
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $(".filter-btn").click(function () {
                var catId = $(this).data("id");
                $(".filter-btn").removeClass("btn-dark").addClass("btn-outline-dark");
                $(this).removeClass("btn-outline-dark").addClass("btn-dark");

                $.ajax({
                    url: '/Home/FilterProperties',
                    type: 'GET',
                    data: { categoryId: catId },
                    success: function (data) {
                        $("#propertyListContainer").html(data);
                    },
                    error: function () {
                        alert("Veriler yüklenirken bir hata oluştu.");
                    }
                });
            });
        });

        function toggleFavorite(propertyId, btnElement) {

            
            console.log("Kalbe tıklandı! ID:", propertyId);

            $.ajax({
                url: '/Favorites/Toggle',
                type: 'POST',
                data: { propertyId: propertyId },
                success: function (response) {
                    if (response.success) {
                        var icon = $(btnElement).find('i');
                        if (response.status === "added") {
                            icon.removeClass('bi-heart').addClass('bi-heart-fill');
                            alert("Favorilere eklendi! ❤️");
                        } else {
                            icon.removeClass('bi-heart-fill').addClass('bi-heart');
                            alert("Favorilerden çıkarıldı. 💔");
                        }
                    } else {
                        alert("İşlem başarısız oldu.");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Hata Detayı:", error);
                    alert("Favori işlemi için lütfen önce giriş yapın veya sayfayı yenileyin.");
                }
            });
        }
    </script>
}